<%- include('../partials/header') %>

<h1><%= t('auditLogs.title') %></h1>

<% if (rbacBypass) { %>
  <div class="alert alert-warning">
    <%= t('security.warnings.rbacDisabled') %>
  </div>
<% } %>

<div class="card">
  <% if (logs.length === 0) { %>
    <p style="text-align: center; color: #999; padding: 2rem;"><%= t('auditLogs.noLogs') %></p>
  <% } else { %>
    <table style="font-size: 0.9rem;">
      <thead>
        <tr>
          <th><%= t('auditLogs.timestamp') %></th>
          <th><%= t('auditLogs.user') %></th>
          <th><%= t('auditLogs.role') %></th>
          <th><%= t('auditLogs.action') %></th>
          <th><%= t('auditLogs.resource') %></th>
          <th><%= t('auditLogs.ipAddress') %></th>
          <th><%= t('auditLogs.success') %></th>
        </tr>
      </thead>
      <tbody>
        <% logs.forEach(log => { %>
          <tr>
            <td style="white-space: nowrap;"><%= formatDate(log.timestamp) %></td>
            <td><%= log.username || 'N/A' %></td>
            <td><%= log.role || 'N/A' %></td>
            <td><%= log.action %></td>
            <td>
              <% if (log.resource_type && log.resource_id) { %>
                <%= log.resource_type %> #<%= log.resource_id %>
              <% } else { %>
                -
              <% } %>
            </td>
            <td><%= log.ip_address || 'N/A' %></td>
            <td>
              <% if (log.success) { %>
                <span style="color: #27ae60;">&#10003;</span>
              <% } else { %>
                <span style="color: #e74c3c;">&#10007;</span>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>

    <% if (totalPages > 1) { %>
      <div style="margin-top: 1.5rem; text-align: center;">
        <% if (currentPage > 1) { %>
          <a href="/admin/audit-logs?page=<%= currentPage - 1 %>" class="btn btn-secondary"><%= t('common.previous') %></a>
        <% } %>
        <span style="margin: 0 1rem;"><%= t('auditLogs.page') %> <%= currentPage %> <%= t('auditLogs.of') %> <%= totalPages %></span>
        <% if (currentPage < totalPages) { %>
          <a href="/admin/audit-logs?page=<%= currentPage + 1 %>" class="btn btn-secondary"><%= t('common.next') %></a>
        <% } %>
      </div>
    <% } %>
  <% } %>
</div>

<%- include('../partials/footer') %>
